(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[6732],{26732:(t,e,s)=>{"use strict";s.r(e);s.d(e,{DocumentManager:()=>b,DocumentWidgetManager:()=>D,IDocumentManager:()=>N,PathStatus:()=>A,SaveHandler:()=>y,SavingStatus:()=>I,isValidFileName:()=>u,renameDialog:()=>c,renameFile:()=>d,shouldOverwrite:()=>h});var i=s(67616);var n=s(66853);var a=s(70278);var r=s(18453);const o="jp-FileDialog";const l="jp-new-name-title";function c(t,e,s){s=s||a.nullTranslator;const r=s.load("jupyterlab");return(0,i.showDialog)({title:r.__("Rename File"),body:new g(e),focusNodeSelector:"input",buttons:[i.Dialog.cancelButton({label:r.__("Cancel")}),i.Dialog.okButton({label:r.__("Rename")})]}).then((s=>{if(!s.value){return null}if(!u(s.value)){void(0,i.showErrorMessage)(r.__("Rename Error"),Error(r.__('"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',s.value)));return null}const a=n.PathExt.dirname(e);const o=n.PathExt.join(a,s.value);return d(t,e,o)}))}function d(t,e,s){return t.rename(e,s).catch((i=>{if(i.response.status!==409){throw i}return h(s).then((i=>{if(i){return t.overwrite(e,s)}return Promise.reject("File not renamed")}))}))}function h(t,e){e=e||a.nullTranslator;const s=e.load("jupyterlab");const n={title:s.__("Overwrite file?"),body:s.__('"%1" already exists, overwrite?',t),buttons:[i.Dialog.cancelButton({label:s.__("Cancel")}),i.Dialog.warnButton({label:s.__("Overwrite")})]};return(0,i.showDialog)(n).then((t=>Promise.resolve(t.button.accept)))}function u(t){const e=/[\/\\:]/;return t.length>0&&!e.test(t)}class g extends r.Widget{constructor(t){super({node:_.createRenameNode(t)});this.addClass(o);const e=n.PathExt.extname(t);const s=this.inputNode.value=n.PathExt.basename(t);this.inputNode.setSelectionRange(0,s.length-e.length)}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}var _;(function(t){function e(t,e){e=e||a.nullTranslator;const s=e.load("jupyterlab");const i=document.createElement("div");const n=document.createElement("label");n.textContent=s.__("File Path");const r=document.createElement("span");r.textContent=t;const o=document.createElement("label");o.textContent=s.__("New Name");o.className=l;const c=document.createElement("input");i.appendChild(n);i.appendChild(r);i.appendChild(o);i.appendChild(c);return i}t.createRenameNode=e})(_||(_={}));var p=s(70865);var v=s(47063);var f=s(98034);var m=s(97083);var w=s(8595);class y{constructor(t){this._autosaveTimer=-1;this._minInterval=-1;this._interval=-1;this._isActive=false;this._inDialog=false;this._isDisposed=false;this._startTime=(new Date).getTime();this._context=t.context;const e=t.saveInterval||120;this._minInterval=e*1e3;this._interval=this._minInterval;this._context.fileChanged.connect(this._setTimer,this);this._context.disposed.connect(this.dispose,this)}get saveInterval(){return this._interval/1e3}set saveInterval(t){this._minInterval=this._interval=t*1e3;if(this._isActive){this._setTimer()}}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;clearTimeout(this._autosaveTimer);w.Signal.clearData(this)}start(){this._isActive=true;this._setTimer()}stop(){this._isActive=false;clearTimeout(this._autosaveTimer)}_setTimer(){clearTimeout(this._autosaveTimer);if(!this._isActive){return}this._autosaveTimer=window.setTimeout((()=>{this._save()}),this._interval)}_save(){var t,e;const s=(new Date).getTime()-this._startTime;this._startTime=(new Date).getTime();console.log("HR_JUPYTER_LOG: Time since last autosave, ",s);(e=(t=window[window["_fs_namespace"]])===null||t===void 0?void 0:t.event)===null||e===void 0?void 0:e.call(t,"HR_JUPYTER_LOG: Time since last autosave, ",s);const i=this._context;this._setTimer();if(!i){return}const n=i.contentsModel&&i.contentsModel.writable;if(!n||!i.model.dirty||this._inDialog){return}const a=(new Date).getTime();i.save().then((()=>{var t,e;if(this.isDisposed){return}const s=(new Date).getTime()-a;(e=(t=window[window["_fs_namespace"]])===null||t===void 0?void 0:t.event)===null||e===void 0?void 0:e.call(t,"HR_JUPTER_LOG: Finished saving in, ",{duration:s,interval:this._interval});console.log("HR_JUPTER_LOG: Finished saving in, ",{duration:s,interval:this._interval})})).catch((t=>{if(t.message==="Cancel"||t.message==="Modal is already displayed"){return}console.error("Error in Auto-Save",t.message)}))}}var P=s(15989);var C=s(64936);const x="jp-Document";class D{constructor(t){this._activateRequested=new w.Signal(this);this._isDisposed=false;this._registry=t.registry;this.translator=t.translator||a.nullTranslator}get activateRequested(){return this._activateRequested}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;w.Signal.disconnectReceiver(this)}createWidget(t,e){const s=t.createNew(e);this._initializeWidget(s,t,e);return s}_initializeWidget(t,e,s){M.factoryProperty.set(t,e);const i=new P.DisposableSet;(0,v.each)(this._registry.widgetExtensions(e.name),(e=>{const n=e.createNew(t,s);if(n){i.add(n)}}));M.disposablesProperty.set(t,i);t.disposed.connect(this._onWidgetDisposed,this);this.adoptWidget(s,t);s.fileChanged.connect(this._onFileChanged,this);s.pathChanged.connect(this._onPathChanged,this);void s.ready.then((()=>{void this.setCaption(t)}))}adoptWidget(t,e){const s=M.widgetsProperty.get(t);s.push(e);C.MessageLoop.installMessageHook(e,this);e.addClass(x);e.title.closable=true;e.disposed.connect(this._widgetDisposed,this);M.contextProperty.set(e,t)}findWidget(t,e){const s=M.widgetsProperty.get(t);if(!s){return undefined}return(0,v.find)(s,(t=>{const s=M.factoryProperty.get(t);if(!s){return false}return s.name===e}))}contextForWidget(t){return M.contextProperty.get(t)}cloneWidget(t){const e=M.contextProperty.get(t);if(!e){return undefined}const s=M.factoryProperty.get(t);if(!s){return undefined}const i=s.createNew(e,t);this._initializeWidget(i,s,e);return i}closeWidgets(t){const e=M.widgetsProperty.get(t);return Promise.all((0,v.toArray)((0,v.map)(e,(t=>this.onClose(t))))).then((()=>undefined))}deleteWidgets(t){const e=M.widgetsProperty.get(t);return Promise.all((0,v.toArray)((0,v.map)(e,(t=>this.onDelete(t))))).then((()=>undefined))}messageHook(t,e){switch(e.type){case"close-request":void this.onClose(t);return false;case"activate-request":{const e=this.contextForWidget(t);if(e){this._activateRequested.emit(e.path)}break}default:break}return true}async setCaption(t){const e=this.translator.load("jupyterlab");const s=M.contextProperty.get(t);if(!s){return}const i=s.contentsModel;if(!i){t.title.caption="";return}return s.listCheckpoints().then((a=>{if(t.isDisposed){return}const r=a[a.length-1];const o=r?n.Time.format(r.last_modified):"None";let l=e.__("Name: %1\nPath: %2\n",i.name,i.path);if(s.model.readOnly){l+=e.__("Read-only")}else{l+=e.__("Last Saved: %1\n",n.Time.format(i.last_modified))+e.__("Last Checkpoint: %1",o)}t.title.caption=l}))}async onClose(t){var e;const[s,i]=await this._maybeClose(t,this.translator);if(t.isDisposed){return true}if(s){if(!i){const s=M.contextProperty.get(t);if(!s){return true}if((e=s.contentsModel)===null||e===void 0?void 0:e.writable){await s.save()}else{await s.saveAs()}}if(t.isDisposed){return true}t.dispose()}return s}onDelete(t){t.dispose();return Promise.resolve(void 0)}_maybeClose(t,e){var s;e=e||a.nullTranslator;const n=e.load("jupyterlab");const r=M.contextProperty.get(t);if(!r){return Promise.resolve([true,true])}let o=M.widgetsProperty.get(r);if(!o){return Promise.resolve([true,true])}o=(0,v.toArray)((0,v.filter)(o,(t=>{const e=M.factoryProperty.get(t);if(!e){return false}return e.readOnly===false})));const l=M.factoryProperty.get(t);if(!l){return Promise.resolve([true,true])}const c=r.model;if(!c.dirty||o.length>1||l.readOnly){return Promise.resolve([true,true])}const d=t.title.label;const h=((s=r.contentsModel)===null||s===void 0?void 0:s.writable)?n.__("Save"):n.__("Save as");return(0,i.showDialog)({title:n.__("Save your work"),body:n.__('Save changes in "%1" before closing?',d),buttons:[i.Dialog.cancelButton({label:n.__("Cancel")}),i.Dialog.warnButton({label:n.__("Discard")}),i.Dialog.okButton({label:h})]}).then((t=>[t.button.accept,t.button.displayType==="warn"]))}_widgetDisposed(t){const e=M.contextProperty.get(t);if(!e){return}const s=M.widgetsProperty.get(e);if(!s){return}v.ArrayExt.removeFirstOf(s,t);if(!s.length){e.dispose()}}_onWidgetDisposed(t){const e=M.disposablesProperty.get(t);e.dispose()}_onFileChanged(t){const e=M.widgetsProperty.get(t);(0,v.each)(e,(t=>{void this.setCaption(t)}))}_onPathChanged(t){const e=M.widgetsProperty.get(t);(0,v.each)(e,(t=>{void this.setCaption(t)}))}}var M;(function(t){t.contextProperty=new m.AttachedProperty({name:"context",create:()=>undefined});t.factoryProperty=new m.AttachedProperty({name:"factory",create:()=>undefined});t.widgetsProperty=new m.AttachedProperty({name:"widgets",create:()=>[]});t.disposablesProperty=new m.AttachedProperty({name:"disposables",create:()=>new P.DisposableSet})})(M||(M={}));class b{constructor(t){this._activateRequested=new w.Signal(this);this._contexts=[];this._isDisposed=false;this._autosave=true;this._autosaveInterval=120;this._lastModifiedCheckMargin=500;this.translator=t.translator||a.nullTranslator;this.registry=t.registry;this.services=t.manager;this._collaborative=!!t.collaborative;this._dialogs=t.sessionDialogs||i.sessionContextDialogs;this._docProviderFactory=t.docProviderFactory;this._opener=t.opener;this._when=t.when||t.manager.ready;const e=new D({registry:this.registry,translator:this.translator});e.activateRequested.connect(this._onActivateRequested,this);this._widgetManager=e;this._setBusy=t.setBusy}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(t){this._autosave=t;this._contexts.forEach((e=>{const s=T.saveHandlerProperty.get(e);if(!s){return}if(t===true&&!s.isActive){s.start()}else if(t===false&&s.isActive){s.stop()}}))}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(t){this._autosaveInterval=t;this._contexts.forEach((e=>{const s=T.saveHandlerProperty.get(e);if(!s){return}s.saveInterval=t||120}))}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(t){this._lastModifiedCheckMargin=t;this._contexts.forEach((e=>{e.lastModifiedCheckMargin=t}))}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;w.Signal.clearData(this);this._contexts.forEach((t=>this._widgetManager.closeWidgets(t)));this._widgetManager.dispose();this._contexts.length=0}cloneWidget(t){return this._widgetManager.cloneWidget(t)}closeAll(){return Promise.all(this._contexts.map((t=>this._widgetManager.closeWidgets(t)))).then((()=>undefined))}closeFile(t){const e=this._contextsForPath(t).map((t=>this._widgetManager.closeWidgets(t)));return Promise.all(e).then((t=>undefined))}contextForWidget(t){return this._widgetManager.contextForWidget(t)}copy(t,e){return this.services.contents.copy(t,e)}createNew(t,e="default",s){return this._createOrOpenDocument("create",t,e,s)}deleteFile(t){return this.services.sessions.stopIfNeeded(t).then((()=>this.services.contents.delete(t))).then((()=>{this._contextsForPath(t).forEach((t=>this._widgetManager.deleteWidgets(t)));return Promise.resolve(void 0)}))}findWidget(t,e="default"){const s=n.PathExt.normalize(t);let i=[e];if(e==="default"){const t=this.registry.defaultWidgetFactory(s);if(!t){return undefined}i=[t.name]}else if(e===null){i=this.registry.preferredWidgetFactories(s).map((t=>t.name))}for(const n of this._contextsForPath(s)){for(const t of i){if(t!==null){const e=this._widgetManager.findWidget(n,t);if(e){return e}}}}return undefined}newUntitled(t){if(t.type==="file"){t.ext=t.ext||".txt"}return this.services.contents.newUntitled(t)}open(t,e="default",s,i){return this._createOrOpenDocument("open",t,e,s,i)}openOrReveal(t,e="default",s,i){const n=this.findWidget(t,e);if(n){this._opener.open(n,i||{});return n}return this.open(t,e,s,i||{})}overwrite(t,e){const s=`${e}.${f.UUID.uuid4()}`;const i=()=>this.rename(s,e);return this.rename(t,s).then((()=>this.deleteFile(e))).then(i,i)}rename(t,e){return this.services.contents.rename(t,e)}_findContext(t,e){const s=this.services.contents.normalize(t);return(0,v.find)(this._contexts,(t=>t.path===s&&t.factoryName===e))}_contextsForPath(t){const e=this.services.contents.normalize(t);return this._contexts.filter((t=>t.path===e))}_createContext(t,e,s){const i=(t,e)=>{this._widgetManager.adoptWidget(a,t);this._opener.open(t,e)};const n=this.services.contents.getModelDBFactory(t)||undefined;const a=new p.Context({opener:i,manager:this.services,factory:e,path:t,kernelPreference:s,modelDBFactory:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,collaborative:this._collaborative,docProviderFactory:this._docProviderFactory,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator});const r=new y({context:a,saveInterval:this.autosaveInterval});T.saveHandlerProperty.set(a,r);void a.ready.then((()=>{if(this.autosave){r.start()}}));a.disposed.connect(this._onContextDisposed,this);this._contexts.push(a);return a}_onContextDisposed(t){v.ArrayExt.removeFirstOf(this._contexts,t)}_widgetFactoryFor(t,e){const{registry:s}=this;if(e==="default"){const i=s.defaultWidgetFactory(t);if(!i){return undefined}e=i.name}return s.getWidgetFactory(e)}_createOrOpenDocument(t,e,s="default",i,n){const a=this._widgetFactoryFor(e,s);if(!a){return undefined}const r=a.modelName||"text";const o=this.registry.getModelFactory(r);if(!o){return undefined}const l=this.registry.getKernelPreference(e,a.name,i);let c;let d=Promise.resolve(undefined);if(t==="open"){c=this._findContext(e,o.name)||null;if(!c){c=this._createContext(e,o,l);d=this._when.then((()=>c.initialize(false)))}}else if(t==="create"){c=this._createContext(e,o,l);d=this._when.then((()=>c.initialize(true)))}else{throw new Error(`Invalid argument 'which': ${t}`)}const h=this._widgetManager.createWidget(a,c);this._opener.open(h,n||{});d.catch((t=>{console.error(`Failed to initialize the context with '${o.name}' for ${e}`,t);h.close()}));return h}_onActivateRequested(t,e){this._activateRequested.emit(e)}}var T;(function(t){t.saveHandlerProperty=new m.AttachedProperty({name:"saveHandler",create:()=>undefined})})(T||(T={}));var F=s(26351);var S=s(2411);var W=s.n(S);function E(t){return W().createElement(F.TextItem,{source:t.name,title:t.fullPath})}class A extends i.VDomRenderer{constructor(t){super(new A.Model(t.docManager));this.node.title=this.model.path}render(){return W().createElement(E,{fullPath:this.model.path,name:this.model.name})}}(function(t){class e extends i.VDomModel{constructor(t){super();this._onTitleChange=t=>{const e=this._getAllState();this._name=t.label;this._triggerChange(e,this._getAllState())};this._onPathChange=(t,e)=>{const s=this._getAllState();this._path=e;this._name=n.PathExt.basename(e);this._triggerChange(s,this._getAllState())};this._path="";this._name="";this._widget=null;this._docManager=t}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(t){const e=this._widget;if(e!==null){const t=this._docManager.contextForWidget(e);if(t){t.pathChanged.disconnect(this._onPathChange)}else{e.title.changed.disconnect(this._onTitleChange)}}const s=this._getAllState();this._widget=t;if(this._widget===null){this._path="";this._name=""}else{const t=this._docManager.contextForWidget(this._widget);if(t){this._path=t.path;this._name=n.PathExt.basename(t.path);t.pathChanged.connect(this._onPathChange)}else{this._path="";this._name=this._widget.title.label;this._widget.title.changed.connect(this._onTitleChange)}}this._triggerChange(s,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(t,e){if(t[0]!==e[0]||t[1]!==e[1]){this.stateChanged.emit(void 0)}}}t.Model=e})(A||(A={}));function R(t){return W().createElement(F.TextItem,{source:t.fileStatus})}const k=2e3;class I extends i.VDomRenderer{constructor(t){super(new I.Model(t.docManager));const e=t.translator||a.nullTranslator;const s=e.load("jupyterlab");this._statusMap={completed:s.__("Saving completed"),started:s.__("Saving started"),failed:s.__("Saving failed")}}render(){if(this.model===null||this.model.status===null){return null}else{return W().createElement(R,{fileStatus:this._statusMap[this.model.status]})}}}(function(t){class e extends i.VDomModel{constructor(t){super();this._onStatusChange=(t,e)=>{this._status=e;if(this._status==="completed"){setTimeout((()=>{this._status=null;this.stateChanged.emit(void 0)}),k);this.stateChanged.emit(void 0)}else{this.stateChanged.emit(void 0)}};this._status=null;this._widget=null;this._status=null;this.widget=null;this._docManager=t}get status(){return this._status}get widget(){return this._widget}set widget(t){var e,s;const i=this._widget;if(i!==null){const t=this._docManager.contextForWidget(i);if(t){t.saveState.disconnect(this._onStatusChange)}else if((e=this._widget.content)===null||e===void 0?void 0:e.saveStateChanged){this._widget.content.saveStateChanged.disconnect(this._onStatusChange)}}this._widget=t;if(this._widget===null){this._status=null}else{const t=this._docManager.contextForWidget(this._widget);if(t){t.saveState.connect(this._onStatusChange)}else if((s=this._widget.content)===null||s===void 0?void 0:s.saveStateChanged){this._widget.content.saveStateChanged.connect(this._onStatusChange)}}}}t.Model=e})(I||(I={}));const N=new f.Token("@jupyterlab/docmanager:IDocumentManager")}}]);
//# sourceMappingURL=6732.cecc1e5e3e06e0ca87e7.js.map?v=cecc1e5e3e06e0ca87e7